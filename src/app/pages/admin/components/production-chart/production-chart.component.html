<div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-center mb-8">
    <div class="flex flex-col">
      <h3 class="text-lg font-bold text-gray-800">
        Produção: <span class="text-purple-600">{{ viewMode() }}</span>
      </h3>
      <div class="flex items-baseline gap-2">
        <span class="text-3xl font-bold text-purple-600">{{ totalProduction() | number }}</span>
        <span class="text-gray-400 text-sm">Total Produzido</span>
      </div>
    </div>

    <div class="flex gap-2 relative">
      <!-- Dropdown Button -->
      <button
        (click)="toggleDropdown()"
        class="flex items-center gap-2 px-4 py-2 bg-purple-50 text-purple-700 rounded-full text-sm font-medium hover:bg-purple-100 transition-colors"
      >
        <span>{{ viewMode() }}</span>
        <z-icon zType="chevron-down" class="w-4 h-4" />
      </button>

      <!-- Dropdown Menu -->
      @if (isDropdownOpen()) {
      <div
        class="absolute top-12 right-0 w-32 bg-white rounded-xl shadow-xl border border-gray-100 py-2 z-50"
      >
        @for (mode of availableModes; track mode) {
        <button
          (click)="setMode(mode)"
          class="w-full text-left px-4 py-2 text-sm text-gray-600 hover:bg-purple-50 hover:text-purple-700 transition-colors"
          [class.bg-purple-50]="viewMode() === mode"
          [class.text-purple-700]="viewMode() === mode"
        >
          {{ mode }}
        </button>
        }
      </div>
      }
    </div>
  </div>

  <!-- Chart Area -->
  <div class="relative w-full h-[300px] select-none">
    <svg viewBox="0 0 800 300" preserveAspectRatio="none" class="w-full h-full overflow-visible">
      <defs>
        <linearGradient id="chartGradient" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%" stop-color="#9333ea" stop-opacity="0.2" />
          <stop offset="100%" stop-color="#9333ea" stop-opacity="0" />
        </linearGradient>
      </defs>

      <!-- Grid Lines -->
      @for (line of [0, 1, 2, 3, 4]; track line) {
      <line
        x1="0"
        [attr.y1]="40 + (line * 260) / 4"
        x2="800"
        [attr.y2]="40 + (line * 260) / 4"
        stroke="#f3f4f6"
        stroke-width="1"
      />
      }

      <!-- Area Fill -->
      <path
        [attr.d]="areaPath()"
        fill="url(#chartGradient)"
        stroke="none"
        class="transition-all duration-500 ease-in-out"
      />

      <!-- Line Path -->
      <path
        [attr.d]="pathD()"
        fill="none"
        stroke="#9333ea"
        stroke-width="3"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="drop-shadow-sm transition-all duration-500 ease-in-out"
      />

      <!-- Points -->
      @for (p of points(); track p.label; let i = $index) {
      <g class="group cursor-pointer">
        <!-- Hover Area -->
        <circle [attr.cx]="p.x" [attr.cy]="p.y" r="15" fill="transparent" />

        <!-- Visible Point -->
        <circle
          [attr.cx]="p.x"
          [attr.cy]="p.y"
          r="4"
          fill="white"
          stroke="#9333ea"
          stroke-width="2"
          class="transition-all duration-300 group-hover:scale-150 group-hover:stroke-width-4"
        />

        <!-- Tooltip -->
        <foreignObject
          [attr.x]="p.x - 50"
          [attr.y]="p.y - 60"
          width="100"
          height="50"
          class="opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50"
        >
          <div
            class="bg-gray-900 text-white text-xs py-2 px-3 rounded-xl text-center shadow-xl border border-gray-700"
          >
            <div class="font-bold border-b border-gray-700 pb-1 mb-1">{{ p.label }}</div>
            <div>{{ p.value | number }}</div>
          </div>
        </foreignObject>

        <!-- Label -->
        <text
          [attr.x]="p.x"
          y="290"
          text-anchor="middle"
          class="text-[10px] fill-gray-400 font-medium"
        >
          {{ p.label }}
        </text>
      </g>
      }
    </svg>

    @if (points().length === 0) {
    <div class="absolute inset-0 flex items-center justify-center text-gray-400">
      Aguardando dados...
    </div>
    }
  </div>
</div>
