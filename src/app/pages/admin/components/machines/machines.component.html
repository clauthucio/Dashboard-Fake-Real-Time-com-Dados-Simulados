<div class="space-y-6">
  <div class="flex justify-between items-center">
    <div>
      <h2 class="text-2xl font-bold text-gray-800">Máquinas</h2>
      <p class="text-gray-500">Gestão de máquinas da fábrica</p>
    </div>
  </div>

  <!-- Error State -->
  <div
    *ngIf="errorMessage"
    class="bg-red-50 border border-red-200 text-red-700 p-4 rounded-xl flex items-center justify-between"
  >
    <div class="flex items-center gap-3">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
      <span>{{ errorMessage }}</span>
    </div>
    <button z-button (click)="refresh()">Tentar novamente</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="space-y-4">
    <z-skeleton class="h-16 rounded-xl" />
    <z-skeleton class="h-16 rounded-xl" />
    <z-skeleton class="h-16 rounded-xl" />
    <z-skeleton class="h-16 rounded-xl" />
  </div>

  <!-- Content -->
  <div
    *ngIf="!isLoading"
    class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden"
  >
    <table class="w-full text-left">
      <thead
        class="bg-gray-50 border-b border-gray-100 text-xs font-semibold text-gray-500 uppercase tracking-wider"
      >
        <tr>
          <th class="p-6">Nome</th>
          <th class="p-6">Setor</th>
          <th class="p-6">Status</th>
          <th class="p-6">Alerta</th>
          <th class="p-6">Atualização</th>
          <th class="p-6 text-center">Ações</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-50">
        <tr
          *ngFor="let machine of pagedMachines"
          (click)="openDetails(machine)"
          class="hover:bg-gray-50 transition-colors cursor-pointer"
        >
          <td class="p-6 font-medium text-gray-900 leading-6">{{ machine.nome }}</td>
          <td class="p-6 text-gray-500 leading-6">{{ machine.setor }}</td>
          <td class="p-6">
            <span
              class="px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide"
              [ngClass]="{
                'bg-green-100 text-green-700':
                  machine.status === 'operacional' || machine.status === 'online',
                'bg-red-100 text-red-700':
                  machine.status === 'offline' || machine.status === 'parada',
                'bg-yellow-100 text-yellow-700': machine.status === 'manutencao'
              }"
            >
              {{ machine.status }}
            </span>
          </td>
          <td class="p-6">
            <span
              class="px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wide"
              [ngClass]="{
                'bg-green-100 text-green-700': machine.alerta.nivel === 'verde',
                'bg-yellow-100 text-yellow-700': machine.alerta.nivel === 'amarelo',
                'bg-red-100 text-red-700': machine.alerta.nivel === 'vermelho'
              }"
            >
              {{ machine.alerta.nivel }}
            </span>
          </td>
          <td class="p-6 text-gray-500 leading-6">
            {{ machine.ultimaAtualizacao | date : 'dd/MM/yyyy HH:mm' }}
          </td>
          <td class="p-6 text-center">
            <div class="flex justify-center gap-2">
              <button
                z-button
                zType="outline"
                (click)="openDetails(machine)"
                title="Visualizar Detalhes"
              >
                <z-icon zType="eye" class="w-4 h-4" />
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div
      class="flex items-center justify-between p-4 border-t border-gray-100 bg-gray-50/50"
      *ngIf="totalPages > 1"
    >
      <button
        z-button
        zType="outline"
        (click)="changePage(currentPage - 1)"
        [disabled]="currentPage === 1"
      >
        Anterior
      </button>
      <span class="text-sm font-medium text-gray-600">
        Página <span class="text-gray-900">{{ currentPage }}</span> de
        <span class="text-gray-900">{{ totalPages }}</span>
      </span>
      <button
        z-button
        zType="outline"
        (click)="changePage(currentPage + 1)"
        [disabled]="currentPage === totalPages"
      >
        Próxima
      </button>
    </div>
  </div>

  <app-modal
    [isOpen]="showModal"
    [title]="selectedMachine?.nome || 'Detalhes da Máquina'"
    (closeEvent)="closeModal()"
  >
    <div class="space-y-8" *ngIf="selectedMachine">
      <!-- Header Info -->
      <div
        class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 p-4 bg-gray-50 rounded-2xl border border-gray-100"
      >
        <div class="flex items-center gap-4">
          <div
            class="h-12 w-12 rounded-full bg-white border border-gray-100 flex items-center justify-center shadow-sm text-gray-400"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
              />
            </svg>
          </div>
          <div>
            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Identificação</p>
            <div class="flex items-baseline gap-2">
              <h3 class="text-lg font-bold text-gray-900">{{ selectedMachine.setor }}</h3>
              <span
                class="font-mono text-xs text-gray-400 bg-white px-1.5 py-0.5 rounded border border-gray-200"
                >{{ selectedMachine.id }}</span
              >
            </div>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div class="text-right">
            <p class="text-xs font-semibold text-gray-400 uppercase">Status Atual</p>
            <div class="flex items-center justify-end gap-2 mt-0.5">
              <span class="relative flex h-2.5 w-2.5">
                <span
                  class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75"
                  [ngClass]="{
                    'bg-green-400':
                      selectedMachine.status === 'online' ||
                      selectedMachine.status === 'operacional',
                    'bg-red-400': selectedMachine.status === 'offline',
                    'bg-yellow-400': selectedMachine.status === 'manutencao'
                  }"
                ></span>
                <span
                  class="relative inline-flex rounded-full h-2.5 w-2.5"
                  [ngClass]="{
                    'bg-green-500':
                      selectedMachine.status === 'online' ||
                      selectedMachine.status === 'operacional',
                    'bg-red-500': selectedMachine.status === 'offline',
                    'bg-yellow-500': selectedMachine.status === 'manutencao'
                  }"
                ></span>
              </span>
              <span class="text-sm font-bold text-gray-700 capitalize">{{
                selectedMachine.status
              }}</span>
            </div>
          </div>

          <div class="h-10 w-px bg-gray-200 mx-1"></div>

          <div class="text-right">
            <p class="text-xs font-semibold text-gray-400 uppercase">Saúde</p>
            <span
              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize mt-1"
              [ngClass]="{
                'bg-green-100 text-green-800': selectedMachine.alerta.nivel === 'verde',
                'bg-yellow-100 text-yellow-800': selectedMachine.alerta.nivel === 'amarelo',
                'bg-red-100 text-red-800': selectedMachine.alerta.nivel === 'vermelho'
              }"
            >
              {{ selectedMachine.alerta.nivel }}
            </span>
          </div>
        </div>
      </div>

      <!-- Alerta Banner -->
      <div
        *ngIf="selectedMachine.alerta.mensagem"
        class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg flex gap-3 shadow-sm"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 text-amber-500 flex-shrink-0"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
            clip-rule="evenodd"
          />
        </svg>
        <div>
          <p class="text-sm font-bold text-amber-800">Atenção Requerida</p>
          <p class="text-sm text-amber-700 mt-0.5">{{ selectedMachine.alerta.mensagem }}</p>
        </div>
      </div>

      <!-- KPIs Grid -->
      <div>
        <h3
          class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"
        >
          <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
          Métricas em Tempo Real
        </h3>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Produção -->
          <div
            class="bg-blue-50/50 p-4 rounded-2xl border border-blue-100 relative overflow-hidden group hover:border-blue-200 transition-colors"
          >
            <div
              class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-blue-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
                />
              </svg>
            </div>
            <p class="text-xs font-semibold text-blue-600 uppercase tracking-wider mb-1">
              Produção
            </p>
            <div class="flex items-baseline gap-1">
              <span class="text-2xl font-bold text-gray-900">{{
                selectedMachine.kpisAtuais.producao
              }}</span>
              <span class="text-xs font-semibold text-gray-400">un</span>
            </div>
            <div class="mt-2 pt-2 border-t border-blue-100 flex justify-between items-center">
              <span class="text-[10px] text-gray-500"
                >Meta: {{ selectedMachine.metas.producaoHora }}/h</span
              >
              <div class="w-16 h-1 bg-blue-100 rounded-full overflow-hidden">
                <div
                  class="h-full bg-blue-500 rounded-full"
                  [style.width.%]="
                    (selectedMachine.kpisAtuais.producao / selectedMachine.metas.producaoHora) * 100
                  "
                ></div>
              </div>
            </div>
          </div>

          <!-- Temperatura -->
          <div
            class="bg-orange-50/50 p-4 rounded-2xl border border-orange-100 relative overflow-hidden group hover:border-orange-200 transition-colors"
          >
            <div
              class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-orange-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"
                />
              </svg>
            </div>
            <p class="text-xs font-semibold text-orange-600 uppercase tracking-wider mb-1">
              Temperatura
            </p>
            <div class="flex items-baseline gap-1">
              <span class="text-2xl font-bold text-gray-900">{{
                selectedMachine.kpisAtuais.temperatura
              }}</span>
              <span class="text-xs font-semibold text-gray-400">°C</span>
            </div>
            <div class="mt-2 pt-2 border-t border-orange-100">
              <span class="text-[10px] text-gray-500"
                >Max Permilitido:
                <span class="font-bold">{{ selectedMachine.metas.temperaturaMax }}°C</span></span
              >
            </div>
          </div>

          <!-- Energia -->
          <div
            class="bg-yellow-50/50 p-4 rounded-2xl border border-yellow-100 relative overflow-hidden group hover:border-yellow-200 transition-colors"
          >
            <div
              class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-yellow-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
              </svg>
            </div>
            <p class="text-xs font-semibold text-yellow-600 uppercase tracking-wider mb-1">
              Consumo
            </p>
            <div class="flex items-baseline gap-1">
              <span class="text-2xl font-bold text-gray-900">{{
                selectedMachine.kpisAtuais.consumoEnergia
              }}</span>
              <span class="text-xs font-semibold text-gray-400">kW</span>
            </div>
            <div class="mt-2 pt-2 border-t border-yellow-100">
              <span class="text-[10px] text-gray-500"
                >Limite:
                <span class="font-bold">{{ selectedMachine.metas.consumoMax }}kW</span></span
              >
            </div>
          </div>

          <!-- Vibração -->
          <div
            class="bg-purple-50/50 p-4 rounded-2xl border border-purple-100 relative overflow-hidden group hover:border-purple-200 transition-colors"
          >
            <div
              class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-12 w-12 text-purple-600"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
                <!-- Using bolt icon as placeholder for vibration frequency wave -->
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
            </div>
            <p class="text-xs font-semibold text-purple-600 uppercase tracking-wider mb-1">
              Vibração
            </p>
            <div class="flex items-baseline gap-1">
              <span class="text-2xl font-bold text-gray-900">{{
                selectedMachine.kpisAtuais.vibracao
              }}</span>
              <span class="text-xs font-semibold text-gray-400">mm/s</span>
            </div>
            <div class="mt-2 pt-2 border-t border-purple-100">
              <span class="text-[10px] text-gray-500">Monitoramento Ativo</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Histórico Table -->
      <div>
        <h3
          class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"
        >
          <span class="w-1.5 h-1.5 rounded-full bg-gray-400"></span>
          Histórico Recente
        </h3>
        <div class="bg-white border boundary-gray-200 rounded-xl overflow-hidden shadow-sm">
          <table class="w-full text-sm text-left">
            <thead class="bg-gray-50 border-b border-gray-100">
              <tr>
                <th class="py-3 px-4 font-semibold text-gray-500 uppercase text-xs tracking-wider">
                  Horário
                </th>
                <th class="py-3 px-4 font-semibold text-gray-500 uppercase text-xs tracking-wider">
                  Output
                </th>
                <th class="py-3 px-4 font-semibold text-gray-500 uppercase text-xs tracking-wider">
                  Temp.
                </th>
                <th
                  class="py-3 px-4 font-semibold text-gray-500 uppercase text-xs tracking-wider text-right"
                >
                  Consumo
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-50">
              <tr
                *ngFor="let item of selectedMachine.historico.slice(-5).reverse()"
                class="hover:bg-gray-50/50"
              >
                <td class="py-3 px-4 text-gray-600 font-mono text-xs">
                  {{ item.hora | date : 'HH:mm:ss' }}
                </td>
                <td class="py-3 px-4 font-medium text-gray-800">{{ item.producao }} un</td>
                <td class="py-3 px-4 font-medium text-gray-800">
                  <span
                    [ngClass]="
                      item.temperatura > selectedMachine.metas.temperaturaMax
                        ? 'text-red-600 font-bold'
                        : ''
                    "
                  >
                    {{ item.temperatura }}°C
                  </span>
                </td>
                <td class="py-3 px-4 font-medium text-gray-800 text-right">
                  {{ item.consumoEnergia }} kW
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </app-modal>
</div>
