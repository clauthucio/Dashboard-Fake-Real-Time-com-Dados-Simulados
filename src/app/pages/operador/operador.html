<div class="container">
  <!-- Parte de identificação -->
  <div class="header">
    <div class="header-left">
      <h1><i class="fas fa-user-cog"></i> Painel do Operador</h1>
      <p class="subtitle">Monitoramento em Tempo Real</p>
    </div>
    <div class="header-right">
      <div class="user-info">
        <span class="user-name">Operador: {{ userName }}</span>
        <span class="user-shift">Turno: {{ user.shift }}</span>
      </div>
      <div class="current-time">{{ currentTime() }}</div>
    </div>
  </div>

  <!-- Dashboard propriamente dito -->
  <main class="dashboard">
    <!-- Cards de Métricas -->
    <section class="metrics-grid">
      @for (metric of metrics(); track metric.id) {
        <div class="metric-card" [class]="getMetricCardClass(metric.trend)">
          <div class="metric-header">
            <h3>{{ metric.title }}</h3>
            <i class="fas {{ metric.icon }}"></i>
          </div>
          <div class="metric-value">{{ metric.value }}</div>
          <div class="metric-label">{{ metric.label }}</div>
          @if (metric.progress !== undefined) {
            <div class="metric-progress">
              <div class="progress-bar" [style.width.%]="metric.progress"></div>
              <span class="progress-text">{{ metric.progress }}%</span>
            </div>
          }
        </div>
      }
    </section>

    <!-- Seção de Máquinas -->
    <section class="machines-section">
      <h2><i class="fas fa-cogs"></i> Status das Máquinas</h2>
      <div class="machines-grid">
        @for (machine of machines(); track machine.id) {
          <div class="machine-card" [class]="getMachineStatusClass(machine.status)">
            <div class="machine-header">
              <i class="fas {{ getMachineStatusIcon(machine.status) }} status-icon"></i>
              <h4>{{ machine.name }}</h4>
            </div>
            <div class="machine-info">
              <p class="status-text">{{ getMachineStatusText(machine.status) }}</p>
              <p class="efficiency">Eficiência: {{ machine.efficiency }}%</p>
              <p class="last-update">Atualizado: {{ machine.lastUpdate | date:'HH:mm:ss' }}</p>
            </div>
          </div>
        } @empty {
          <div class="no-machines">
            <i class="fas fa-industry"></i>
            <p>Nenhuma máquina cadastrada</p>
          </div>
        }
      </div>
      
      <!-- Resumo de Status -->
      <div class="status-summary">
        <div class="summary-item status-running">
          <span class="summary-count">{{ getMachinesByStatus('running').length }}</span>
          <span class="summary-label">Em Operação</span>
        </div>
        <div class="summary-item status-warning">
          <span class="summary-count">{{ getMachinesByStatus('warning').length }}</span>
          <span class="summary-label">Atenção</span>
        </div>
        <div class="summary-item status-stopped">
          <span class="summary-count">{{ getMachinesByStatus('stopped').length }}</span>
          <span class="summary-label">Paradas</span>
        </div>
        <div class="summary-item status-maintenance">
          <span class="summary-count">{{ getMachinesByStatus('maintenance').length }}</span>
          <span class="summary-label">Manutenção</span>
        </div>
      </div>
    </section>

    <!-- Controles -->
    <section class="controls-section">
      <h2><i class="fas fa-tools"></i> Controles</h2>
      <div class="controls">
        <button class="btn btn-primary" 
                [class.loading]="isLoading()" 
                (click)="refreshData()"
                [disabled]="isLoading()">
          <i class="fas fa-sync-alt"></i>
          {{ isLoading() ? 'Atualizando...' : 'Atualizar Dados' }}
        </button>
        
        <button class="btn btn-secondary" 
                (click)="reportIssue()">
          <i class="fas fa-flag"></i> Reportar Problema
        </button>
        
        <button class="btn btn-warning" 
                (click)="toggleLine()"
                [class.paused]="isLinePaused()">
          <i class="fas" 
             [class.fa-pause]="!isLinePaused()" 
             [class.fa-play]="isLinePaused()">
          </i>
          {{ isLinePaused() ? 'Retomar Linha' : 'Pausar Linha' }}
        </button>
        
        <button class="btn btn-danger" 
                (click)="emergencyStop()">
          <i class="fas fa-exclamation-triangle"></i> Parada de Emergência
        </button>
      </div>
      
      <!-- Alerta de Status da Linha -->
      @if (lineStatus() !== 'operando_normalmente') {
        <div class="line-alert" [class]="getLineAlertClass()">
          <i class="fas {{ getLineAlertIcon() }}"></i>
          <span>{{ getLineStatusText() }}</span>
        </div>
      }
    </section>
  </main>
</div>